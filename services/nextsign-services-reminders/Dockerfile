FROM node:18
WORKDIR /app
COPY package*.json /app


COPY . /app

# VARIABLES DE ENTORNO

ENV DB_USER  "postgres"
ENV DB_PASSWORD  "db_admin3264"
ENV DB_NAME  "postgres"
ENV DB_HOST  host.docker.internal
ENV DB_MAX_CONNECTIONS 1
ENV DB_POOL_TIMEOUT 10
ENV DATABASE_URL "postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:5432/${DB_NAME}?schema public&connection_limit ${DB_MAX_CONNECTIONS}&pool_timeout ${DB_POOL_TIMEOUT}"

ENV AWS_GENERAL_ZONE us-east-2
ENV AWS_GENERAL_ACCOUNT_ID 092256779204

#S3
ENV AWS_ACCESS_KEY_ID_S3 AKIARK6XOXPCKVAZWNB6
ENV AWS_SECRET_ACCESS_KEY_S3 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
ENV AWS_BUCKET_NAME nextsign-dev

#SQS CONFIG
ENV AWS_SQS_SERVICE_ENDPOINT https://sqs.us-east-2.amazonaws.com
ENV AWS_ACCOUNT_ID ${AWS_GENERAL_ACCOUNT_ID}
ENV AWS_SQS_QUEUE envelope-signature-dev.fifo
ENV AWS_SQS_QUEUE_SAVE_DOCUMENT envelope-saveDocument-dev.fifo
ENV AWS_SQS_QUEUE_NOTIFY_ENVELOP envelope-notification-dev.fifo
ENV AWS_ACCESS_KEY_ID_SQS AKIARK6XOXPCKVAZWNB6
ENV AWS_SECRET_ACCESS_KEY_SQS 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

#SES
ENV AWS_ACCESS_KEY_ID_EMAIL AKIARK6XOXPCKVAZWNB6
ENV AWS_SECRET_ACCESS_KEY_EMAIL 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
ENV AWS_REGION_EMAIL ${AWS_GENERAL_ZONE}
ENV AWS_SOURCE_EMAIL notifications@dev.nextsign.ec

#TOKEN
ENV SIGN_LINK_URL http://localhost:3000/sign/
ENV SIGN_JWT_SECRET N3xtS1gnD3V2022_

#EMAIL TEMPLATE
ENV SOURCE_IMAGE https://cdn.nextsign.ec/dev/mailing/logo-horizontal-black-180.png
ENV COMPANY_NAME NextGen S.A.
ENV COMPANY_MAIL nextgen.ec
ENV COMPANY_ADDRESS Guayaquil, Ecuador

#LAMBDA CONFIG
ENV AWS_ACCESS_KEY_ID_LAMBDA AKIARK6XOXPCKVAZWNB6
ENV AWS_SECRET_ACCESS_KEY_LAMBDA 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
ENV AWS_LAMBDA_BASE_ARN arn:aws:lambda
ENV AWS_LAMBDA_ACCOUNT_ID ${AWS_GENERAL_ACCOUNT_ID}
ENV AWS_LAMBDA_REGION ${AWS_GENERAL_ZONE}
ENV AWS_LAMBDA_FUNCTION_ENVELOP_DETAILS "${AWS_LAMBDA_BASE_ARN}:${AWS_LAMBDA_REGION}:${AWS_LAMBDA_ACCOUNT_ID}:function:nextsign-sign-dev-getSignEnvelopeDetails"

ENV PORT 8080
RUN npm install
RUN npm run prisma:generate
EXPOSE 8080

CMD [ "npm", "start" ]